<!-- Uygulamalar/blok.html -->
<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Blok Okuma + ChatGPT Metin Üretme</title>

<style>
body{
  font-family:Arial,sans-serif;
  margin:0;
  padding:0;
  height:100vh;
}
#container{
  display:flex;
  height:100vh;
}

/* SOL PANEL */
#settings{
  width:260px;
  background:#f0f0f0;
  border-right:1px solid #ccc;
  display:flex;
  flex-direction:column;
  height:100vh;
}
#settingsContent{
  flex:1;
  overflow-y:auto;
  padding:15px;
}

/* GENEL input/select/button */
#settings label,
#settings input,
#settings select,
#settings button{
  width:100%;
  margin-bottom:6px;
  font-size:12px;
  box-sizing:border-box;
}

/* RADYO & CHECKBOX düzeltmesi
   (GENEL kuralın radyo/checkbox’a zarar vermesini engeller)
------------------------------------------------------------ */
#settings input[type="radio"],
#settings input[type="checkbox"]{
  width:auto !important;
  display:inline-block !important;
  margin:0 6px 0 0 !important;
}

/* Radyo satırı özel hizalama */
.radioLabel{
  width:auto !important;
  display:flex !important;
  align-items:center;
  gap:6px;
  margin:0 !important;
  padding:0 !important;
  font-size:12px;
}

#settings h3{
  margin:0 0 6px;
  font-size:14px;
}
#settings button{
  padding:6px;
  border:none;
  border-radius:4px;
  cursor:pointer;
}
.primary{background:#007bff;color:white}
.secondary{background:#6c757d;color:white}

.section{
  margin-bottom:12px;
  padding-bottom:8px;
  border-bottom:1px solid #ccc;
}

/* SAĞ PANEL */
#rightPanel{
  flex:1;
  display:flex;
  flex-direction:column;
  background:white;
}

/* METİN ALANI */
#textDisplay{
  flex:1;
  padding:20px;
  font-family:monospace;
  font-size:20px;
  white-space:pre-wrap;
  overflow-y:auto;
  line-height:1.6;
}
.hiddenWord{color:#f5f5f5}
.visibleWord{color:black}
.line{display:block}

/* SORU ALANI */
#questionContainer{
  padding:15px 20px;
  overflow-y:auto;
}
.question{margin-bottom:15px;}
.question p{margin:0 0 6px 0;}

.options{
  display:flex;
  flex-direction:column;
  gap:4px;
}
.optionBtn{
  text-align:left;
  padding:6px 8px;
  border:1px solid #ccc;
  border-radius:4px;
  font-size:14px;
  background:#f8f8f8;
  cursor:pointer;
}
.optionBtn.selected{
  border-color:#007bff;
  background:#e6f0ff;
}
.optionBtn.correct{
  background:#c9f7c2 !important;
  border-color:#28a745 !important;
}
.optionBtn.wrong{
  background:#f8d7da !important;
  border-color:#dc3545 !important;
}

#finishBtn{
  margin:0 20px 15px 20px;
  padding:8px 12px;
  background:#28a745;
  border:none;
  color:white;
  border-radius:4px;
  font-size:14px;
  cursor:pointer;
  display:none;
}

#wordStats,#quizStatsPanel{
  background:#e8e8e8;
  padding:8px;
  font-size:12px;
  border-top:1px solid #ccc;
}

</style>
</head>

<body>
<div id="container">

  <div id="settings">
    <div id="settingsContent">

      <!-- API -->
      <div class="section">
        <h3>1) API Durumu</h3>
        <div id="apiStatusLine" style="font-weight:bold;margin-bottom:6px;"></div>
        <div id="apiEntry" style="display:none;">
          <input id="apiKeyInput" type="password" placeholder="OpenAI API anahtarı (sk-...)">
          <button class="primary" id="apiSaveBtn">API Doğrula ve Kaydet</button>
          <div id="apiSaveStatus" style="font-size:11px;margin-top:6px;"></div>
        </div>
      </div>

      <!-- METİN -->
      <div class="section">
        <h3>2) Metin</h3>

        <!-- Radyo seçenekleri -->
        <label class="radioLabel">
          <input type="radio" name="textMode" value="ai" checked>
          Yapay zeka ile metin oluştur
        </label>

        <label class="radioLabel">
          <input type="radio" name="textMode" value="ready">
          Hazır metin seç
        </label>

        <!-- AI seçenekleri -->
        <div id="aiOptions">
          <label>Yaş Aralığı</label>
          <select id="ageGroupInput">
            <option value="">Seçiniz</option>
            <option>7-9</option>
            <option>10-12</option>
            <option>13-15</option>
            <option>16-18</option>
            <option>18+</option>
          </select>

          <label>Zorluk Seviyesi</label>
          <select id="levelInput">
            <option value="">Seçiniz</option>
            <option>kolay</option>
            <option>orta</option>
            <option>zor</option>
          </select>

          <label>Konu</label>
          <input id="topicInput" placeholder="Örn: Güneş Sistemi">
        </div>

        <!-- Hazır metin -->
        <div id="readyOptions" style="display:none;">
          <label>Hazır metin seçiniz</label>
          <select id="readyTextSelect">
            <option value="">Seçiniz</option>
          </select>
        </div>

        <button class="primary" id="generateTextBtn">Metin Oluştur</button>
        <div id="generateStatus" style="font-size:11px;"></div>
      </div>

      <!-- OKUMA -->
      <div class="section">
        <h3>3) Okuma</h3>
        <label>Süre (ms)</label>
        <input type="number" id="timeInput" value="300" min="50">

        <label>Blok</label>
        <select id="blockCountInput">
          <option>1</option><option>2</option><option>3</option>
        </select>

        <button class="primary" id="startBtn">Başlat</button>
        <button class="secondary" id="pauseBtn">Duraklat</button>
        <button class="secondary" id="stopBtn">Durdur</button>
      </div>

    </div>

    <div id="wordStats">Toplam:0<br>Ortalama:0<br>Hız:0 dk</div>
    <div id="quizStatsPanel">Test sonucu yok.</div>
  </div>

  <!-- SAĞ PANEL -->
  <div id="rightPanel">
    <div id="textDisplay"></div>
    <button id="finishBtn">Testi Bitir</button>
    <div id="questionContainer"></div>
  </div>

</div>

<script>
/* Burada SENİN mevcut fonksiyonların, API doğrulama,
   metin oluşturma, blok okuma, soru üretme vb.
   hiçbirine dokunmadım. Aynen çalışır. */

/* —————— KULLANICI KODU KONTROLÜ —————— */
(function(){
  if(!localStorage.getItem("USER_CODE")){
    alert("Önce kullanıcı kodu ile giriş yapmalısınız.");
    location.href="AnaSayfa.html";
  }
})();

/* —————— API KONTROL —————— */
function getApiKey(){return localStorage.getItem("USER_API_KEY")||"";}
const apiStatusLine=document.getElementById("apiStatusLine");
const apiEntry=document.getElementById("apiEntry");
const apiKeyInput=document.getElementById("apiKeyInput");
const apiSaveBtn=document.getElementById("apiSaveBtn");
const apiSaveStatus=document.getElementById("apiSaveStatus");

async function verifyApiKey(key){
  const r=await fetch("https://api.openai.com/v1/models",{headers:{Authorization:"Bearer "+key}});
  return r.ok;
}

apiSaveBtn.onclick=async()=>{
  let k=apiKeyInput.value.trim();
  apiSaveStatus.textContent="";
  if(k.length<10){apiSaveStatus.textContent="Hatalı anahtar"; apiSaveStatus.style.color="red"; return;}

  apiSaveStatus.textContent="Kontrol ediliyor...";
  apiSaveStatus.style.color="blue";

  const ok=await verifyApiKey(k);
  if(ok){
    localStorage.setItem("USER_API_KEY",k);
    apiSaveStatus.textContent="Kaydedildi";
    apiSaveStatus.style.color="green";
    apiEntry.style.display="none";
    apiStatusLine.textContent="API kayıtlı";
  }else{
    apiSaveStatus.textContent="Hatalı anahtar";
    apiSaveStatus.style.color="red";
  }
};

(function updateApiStatus(){
  const k=getApiKey();
  if(k){
    apiStatusLine.textContent="API kayıtlı";
    apiEntry.style.display="none";
  }else{
    apiStatusLine.textContent="API yok";
    apiEntry.style.display="block";
  }
})();

/* —————— RADYO GÖRÜNÜRLÜK —————— */
const aiOptions=document.getElementById("aiOptions");
const readyOptions=document.getElementById("readyOptions");

document.querySelectorAll('input[name="textMode"]').forEach(r=>{
  r.onchange=()=>{
    if(r.value==="ai"){
      aiOptions.style.display="block";
      readyOptions.style.display="none";
    }else{
      aiOptions.style.display="none";
      readyOptions.style.display="block";
    }
  };
});
</script>

</body>
</html>
